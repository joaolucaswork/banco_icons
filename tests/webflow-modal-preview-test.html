<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Webflow Modal Preview Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-section {
            background: white;
            margin: 20px 0;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        .before, .after {
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
        }
        .before { background: #fff5f5; }
        .after { background: #f0fff4; }
        .code-block {
            background: #f4f4f4;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            font-family: 'Courier New', monospace;
            font-size: 11px;
            overflow-x: auto;
            white-space: pre;
            max-height: 300px;
            overflow-y: auto;
        }
        .status {
            padding: 5px 10px;
            border-radius: 4px;
            font-weight: bold;
            margin: 10px 0;
        }
        .status.pass { background: #d4edda; color: #155724; }
        .status.fail { background: #f8d7da; color: #721c24; }
        .status.info { background: #d1ecf1; color: #0c5460; }
        h1 { color: #333; text-align: center; }
        h2 { color: #555; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        .issue-list {
            list-style: none;
            padding: 0;
        }
        .issue-list li {
            padding: 5px 0;
            border-bottom: 1px solid #eee;
        }
        .issue-list li.fixed:before {
            content: "✅ ";
            color: green;
            font-weight: bold;
        }
        .issue-list li.issue:before {
            content: "❌ ";
            color: red;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>Webflow Modal Preview Fix Test</h1>
    <p>Testing that the Webflow modal now displays the optimized SVG code in the preview area instead of the original SVG with CSS dependencies.</p>

    <div class="test-section">
        <h2>Issue Description</h2>
        <p><strong>Problem:</strong> The Webflow modal's code preview was showing the original SVG with Tailwind CSS variables instead of the clean, optimized SVG code.</p>
        <p><strong>Solution:</strong> Updated ActionButtons.svelte to pass the optimized SVG directly to WebflowDialog, and simplified WebflowDialog to use the already-optimized code.</p>
    </div>

    <div class="test-section">
        <h2>Before vs After - Code Preview Content</h2>
        <div class="comparison">
            <div class="before">
                <h3>❌ Before (Problematic)</h3>
                <p><strong>What was displayed in modal preview:</strong></p>
                <div class="code-block" id="before-code"></div>
                <div class="status fail">
                    Contains CSS variables and dependencies
                </div>
            </div>
            <div class="after">
                <h3>✅ After (Fixed)</h3>
                <p><strong>What should now be displayed in modal preview:</strong></p>
                <div class="code-block" id="after-code"></div>
                <div class="status pass">
                    Clean, optimized, self-contained SVG
                </div>
            </div>
        </div>
    </div>

    <div class="test-section">
        <h2>Technical Changes Made</h2>
        <ul class="issue-list">
            <li class="fixed">Updated ActionButtons.svelte to generate optimized SVG with $derived</li>
            <li class="fixed">Pass webflowOptimizedSvg to WebflowDialog instead of formattedSvg</li>
            <li class="fixed">Removed internal optimization logic from WebflowDialog</li>
            <li class="fixed">Simplified WebflowDialog to use svgCode directly for display and copy</li>
            <li class="fixed">Ensured preview shows same code that gets copied to clipboard</li>
        </ul>
    </div>

    <div class="test-section">
        <h2>Validation Checklist</h2>
        <div id="validation-results"></div>
    </div>

    <div class="test-section">
        <h2>Expected User Experience</h2>
        <div class="status info">
            <strong>Now when users open the Webflow modal:</strong>
            <ul style="margin: 10px 0; padding-left: 20px;">
                <li>✅ Code preview shows clean, optimized SVG</li>
                <li>✅ No CSS variables or Tailwind references visible</li>
                <li>✅ Hard-coded colors instead of custom properties</li>
                <li>✅ Responsive dimensions (width: 100%, height: 100%)</li>
                <li>✅ Grouped text elements for better organization</li>
                <li>✅ Preview matches exactly what gets copied</li>
            </ul>
        </div>
    </div>

    <script>
        // Sample problematic SVG (what was shown before)
        const beforeSvg = `<svg width="120" height="120" viewBox="0 0 240 240" fill="none" xmlns="http://www.w3.org/2000/svg" style="color: rgb(0, 200, 141);">
<style>
  .agora-bg { fill: var(--agora-bg-color, currentColor); }
  .agora-text { fill: var(--agora-text-color, currentColor); opacity: 0.9; }
</style>
<path fill-rule="evenodd" clip-rule="evenodd" d="M165.144 23H64.707V123.453H165.144V23Z" class="agora-bg"/>
<path d="M124.082 199.89C121.86 199.893..." class="agora-text"/>
<path d="M162.13 186.095V177.956H171.19..." class="agora-text"/>
<path d="M77.6227 190.556H87.8116V192.99..." class="agora-text"/>
<path d="M206.462 192.074L211.791 179.32..." class="agora-text"/>
<path d="M26.9982 192.074L32.3267 179.32..." class="agora-text"/>
<defs>
<clipPath id="clip0_17_150">
<rect width="95.9661" height="96.9632" fill="white" transform="translate(71.9507 23)"/>
</clipPath>
</defs>
</svg>`;

        // Sample optimized SVG (what should be shown now)
        const afterSvg = `<svg viewBox="0 0 240 240" preserveAspectRatio="xMidYMid meet" style="width: 100%; height: 100%; display: block;" xmlns="http://www.w3.org/2000/svg">
  <path fill="#00C88D" fill-rule="evenodd" clip-rule="evenodd" d="M165.144 23H64.707V123.453H165.144V23Z"/>
  <g data-text-group="true" data-text-line="180">
    <path fill="#ffffff" opacity="0.9" d="M124.082 199.89C121.86 199.893..."/>
    <path fill="#ffffff" opacity="0.9" d="M162.13 186.095V177.956H171.19..."/>
    <path fill="#ffffff" opacity="0.9" d="M77.6227 190.556H87.8116V192.99..."/>
    <path fill="#ffffff" opacity="0.9" d="M206.462 192.074L211.791 179.32..."/>
    <path fill="#ffffff" opacity="0.9" d="M26.9982 192.074L32.3267 179.32..."/>
  </g>
</svg>`;

        // Display code samples
        document.getElementById('before-code').textContent = beforeSvg;
        document.getElementById('after-code').textContent = afterSvg;

        // Run validation tests
        function runValidation() {
            const tests = [
                {
                    name: "No CSS Variables",
                    test: () => !afterSvg.includes('var(--') && !afterSvg.includes('currentColor'),
                    description: "SVG should not contain CSS variables or currentColor references"
                },
                {
                    name: "No CSS Classes",
                    test: () => !afterSvg.includes('class=') && !afterSvg.includes('<style>'),
                    description: "SVG should not contain CSS classes or style blocks"
                },
                {
                    name: "Hard-coded Colors",
                    test: () => afterSvg.includes('fill="#') && afterSvg.includes('#00C88D') && afterSvg.includes('#ffffff'),
                    description: "SVG should contain direct hex color values"
                },
                {
                    name: "Responsive Dimensions",
                    test: () => afterSvg.includes('width: 100%') && afterSvg.includes('height: 100%') && !afterSvg.includes('width="120"'),
                    description: "SVG should have responsive dimensions, not fixed pixel values"
                },
                {
                    name: "Text Grouping",
                    test: () => afterSvg.includes('data-text-group="true"'),
                    description: "SVG should have grouped text elements"
                },
                {
                    name: "Proper ViewBox",
                    test: () => afterSvg.includes('viewBox="0 0 240 240"'),
                    description: "SVG should preserve viewBox for scaling"
                },
                {
                    name: "Preserve Aspect Ratio",
                    test: () => afterSvg.includes('preserveAspectRatio="xMidYMid meet"'),
                    description: "SVG should have proper aspect ratio preservation"
                }
            ];

            const results = tests.map(test => ({
                ...test,
                passed: test.test()
            }));

            const passed = results.filter(r => r.passed).length;
            const total = results.length;

            const resultsHtml = `
                <div class="status ${passed === total ? 'pass' : 'fail'}">
                    <strong>Validation Results:</strong> ${passed}/${total} tests passed (${Math.round((passed/total)*100)}%)
                </div>
                ${results.map(result => `
                    <div class="status ${result.passed ? 'pass' : 'fail'}">
                        <strong>${result.name}:</strong> ${result.passed ? 'PASS' : 'FAIL'} - ${result.description}
                    </div>
                `).join('')}
            `;

            document.getElementById('validation-results').innerHTML = resultsHtml;
        }

        // Run validation when page loads
        document.addEventListener('DOMContentLoaded', runValidation);
    </script>
</body>
</html>
